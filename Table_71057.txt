OBJECT Table 71057 Student Attendance Line
{
  OBJECT-PROPERTIES
  {
    Date=31-07-14;
    Time=02:33:54;
    Modified=Yes;
    Version List=EDU3.0;
  }
  PROPERTIES
  {
    OnInsert=BEGIN
               // Start 01.KATHIR
               IF StudentAttendanceHeader.GET("Document No.") THEN
                // Start 10.VIGNESH
                 IF NOT StudentAttendanceHeader."Present All" THEN BEGIN
                // Stop 10.VIGNESH
                   Class := StudentAttendanceHeader.Class;
                   Section := StudentAttendanceHeader.Section;
                   "Subject Code" := StudentAttendanceHeader."Subject Code";
                   Date := StudentAttendanceHeader.Date;
                   Hour := StudentAttendanceHeader.Hour;
                   "Academic Year" := StudentAttendanceHeader."Academic Year";
                   Curriculum := StudentAttendanceHeader.Curriculum;
                 // Start 10.VIGNESH
                 END ELSE
                   ERROR(Text000);
                 // Stop 10.VIGNESH
               // Stop 01.KATHIR
             END;

    CaptionML=ENU=Student Attendance Line;
  }
  FIELDS
  {
    { 1   ;   ;Document No.        ;Code20        ;CaptionML=ENU=Document No. }
    { 2   ;   ;Line No.            ;Integer       ;CaptionML=ENU=Line No. }
    { 3   ;   ;Class               ;Code20        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Student Attendance Header".Class WHERE (No.=FIELD(Document No.)));
                                                   CaptionML=ENU=Class;
                                                   Editable=No }
    { 4   ;   ;Section             ;Code10        ;TableRelation=Section;
                                                   CaptionML=ENU=Section }
    { 5   ;   ;Curriculum          ;Code20        ;TableRelation=Curriculum;
                                                   CaptionML=ENU=Curriculum }
    { 6   ;   ;Subject Code        ;Code20        ;TableRelation=Subject;
                                                   CaptionML=ENU=Subject Code }
    { 7   ;   ;Date                ;Date          ;CaptionML=ENU=Date }
    { 8   ;   ;Hour                ;Integer       ;CaptionML=ENU=Hour }
    { 9   ;   ;Student No.         ;Code20        ;TableRelation=Student WHERE (Student Status=FILTER(Student));
                                                   OnValidate=BEGIN
                                                                {
                                                                Student.CLEARMARKS;
                                                                Student.RESET;
                                                                // Start 02.KATHIR
                                                                IF StudentAttendanceHeader.GET("Document No.") THEN BEGIN
                                                                 // Start 11.VIGNESH
                                                                  IF NOT StudentAttendanceHeader."Present All" THEN BEGIN
                                                                 // Stop 11.VIGNESH
                                                                    StudentSubjects.RESET;
                                                                    StudentSubjects.SETCURRENTKEY(Class,Section,Curriculum,"Academic Year");
                                                                    StudentSubjects.SETRANGE("Class Code",StudentAttendanceHeader."Class Code");
                                                                    StudentSubjects.SETRANGE(Subject,StudentAttendanceHeader."Subject Code");
                                                                    StudentSubjects.SETRANGE("Student No.","Student No.");
                                                                    IF StudentSubjects.FINDFIRST THEN BEGIN
                                                                      IF Student.GET(StudentSubjects."Student No.") AND (Student."Student Status" = Student."Student Status"::Student)
                                                                      THEN BEGIN
                                                                        StudentAttendanceLine.RESET;
                                                                        StudentAttendanceLine.SETRANGE("Document No.","Document No.");
                                                                        StudentAttendanceLine.SETRANGE("Student No.",Student."No.");
                                                                        IF StudentAttendanceLine.COUNT = 0 THEN
                                                                          "Student Name" := Student.Name
                                                                        ELSE BEGIN
                                                                          "Student No." := '';
                                                                          "Student Name" := '';
                                                                          ERROR(Text001);
                                                                        END;
                                                                      END ELSE BEGIN
                                                                        "Student No." := '';
                                                                        "Student Name" := '';
                                                                      END;
                                                                    END ELSE BEGIN
                                                                      "Student No." := '';
                                                                      "Student Name" := '';
                                                                      ERROR(Text002,"Student No.",StudentAttendanceHeader.Class);
                                                                    END;
                                                                  END ELSE
                                                                    ERROR(Text000);
                                                                END;
                                                                // Stop 02.KATHIR
                                                                }
                                                              END;

                                                   OnLookup=BEGIN
                                                              Student.CLEARMARKS;
                                                              Student.RESET;
                                                              // Start 02.KATHIR
                                                              IF StudentAttendanceHeader.GET("Document No.") THEN BEGIN
                                                               // Start 11.VIGNESH
                                                                IF NOT StudentAttendanceHeader."Present All" THEN BEGIN
                                                               // Stop 11.VIGNESH
                                                                  StudentSubjects.RESET;
                                                                  StudentSubjects.SETCURRENTKEY(Class,Section,Curriculum,"Academic Year");
                                                                  StudentSubjects.SETRANGE("Class Code",StudentAttendanceHeader."Class Code");
                                                                  StudentSubjects.SETRANGE(Subject,StudentAttendanceHeader."Subject Code");
                                                                  IF StudentSubjects.FINDSET THEN
                                                                    REPEAT
                                                                      IF Student.GET(StudentSubjects."Student No.") THEN
                                                                        IF Student."Student Status" = Student."Student Status"::Student THEN
                                                                          Student.MARK(TRUE);
                                                                    UNTIL StudentSubjects.NEXT = 0;
                                                                  Student.MARKEDONLY(TRUE);
                                                                  IF PAGE.RUNMODAL(0,Student) = ACTION::LookupOK THEN BEGIN
                                                                    // Start 09.VIGNESH
                                                                    StudentAttendanceLine.RESET;
                                                                    StudentAttendanceLine.SETRANGE("Document No.","Document No.");
                                                                    StudentAttendanceLine.SETRANGE("Student No.",Student."No.");
                                                                    IF StudentAttendanceLine.ISEMPTY THEN BEGIN
                                                                    // Stop 09.VIGNESH
                                                                      "Student No." := Student."No.";
                                                                      "Student Name" := Student.Name;
                                                                    // Start 11.VIGNESH
                                                                    END ELSE BEGIN
                                                                      "Student No." := '';
                                                                      "Student Name" := '';
                                                                      ERROR(Text001);
                                                                    END;
                                                                    // Stop 11.VIGNESH
                                                                    //END;
                                                                  END;
                                                                END ELSE
                                                                  ERROR(Text000);
                                                              END;
                                                              // Stop 02.KATHIR
                                                            END;

                                                   CaptionML=ENU=Student No. }
    { 10  ;   ;Student Name        ;Text50        ;CaptionML=ENU=Student Name }
    { 11  ;   ;Attendance Type     ;Option        ;CaptionML=ENU=Attendance Type;
                                                   OptionCaptionML=ENU=" ,Present,Absent,On Duty,Leave";
                                                   OptionString=[ ,Present,Absent,On Duty,Leave] }
    { 12  ;   ;Academic Year       ;Code20        ;TableRelation="Academic Year";
                                                   CaptionML=ENU=Academic Year }
    { 13  ;   ;Description         ;Text50        ;CaptionML=ENU=Description }
    { 14  ;   ;Class Code          ;Code20        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Student Attendance Header"."Class Code" WHERE (No.=FIELD(Document No.)));
                                                   TableRelation="Class Section";
                                                   OnValidate=BEGIN
                                                                IF ClassSection.GET("Class Code") THEN BEGIN
                                                                  Class := ClassSection.Class;
                                                                  Section := ClassSection.Section;
                                                                  Curriculum := ClassSection.Curriculum;
                                                                  "Academic Year" := ClassSection."Academic Year";
                                                                END;
                                                              END;

                                                   CaptionML=ENU=Class Code;
                                                   Editable=No }
  }
  KEYS
  {
    {    ;Document No.,Line No.                   ;Clustered=Yes }
  }
  FIELDGROUPS
  {
  }
  CODE
  {
    VAR
      StudentAttendanceHeader@1102155000 : Record 71056;
      Student@1102155001 : Record 71046;
      StudentSubjects@1102155002 : Record 71049;
      ClassSection@1102155003 : Record 71015;
      StudentAttendanceLine@1102155004 : Record 71057;
      Text000@1102155005 : TextConst 'ENU=All  is marked present.';
      Text001@1102155006 : TextConst 'ENU=The student is already selected.';
      Text002@1102155007 : TextConst 'ENU=Student %1 does not belong to class %2.';

    BEGIN
    {
        No   Date      Sign     Trigger                     Description
      -----------------------------------------------------------------------------------------------
        01  05/10/09  KATHIR    OnInsert()                  code added to Insert details from Student attendance header
        02  05/10/09  KATHIR    Student No. - OnLookup()   Code added to get Student Nos for Particular class,acad yr,curriculum,section
        03  23/11/09   VIGNESH  Class - OnValidate()        Code added to get the Class Section & Curriculum
        04  23/11/09   VIGNESH  Class - OnLookup()          Code added to get the Class Section & Curriculum
        05  23/11/09   VIGNESH  Curriculum - OnValidate()   Code added to get the Class Section & Curriculum
        06  23/11/09   VIGNESH  Curriculum - OnLookup()     Code added to get the Class Section & Curriculum
        07  23/11/09   VIGNESH  Section - OnValidate()      Code added to get the Class Section & Curriculum
        08  23/11/09   VIGNESH  Section - OnLookup()        Code added to get the Class Section & Curriculum
        09  27/11/09   VIGNESH  Student No. - OnLookup()    Code added to validate the student if already there
        10  27/11/09   VIGNESH  OnInsert()                  Code added to Validate if Present all is marked
        11  27/11/09   VIGNESH  Student No. - OnLookup()    Code added to Validate if Present all is marked
    }
    END.
  }
}

